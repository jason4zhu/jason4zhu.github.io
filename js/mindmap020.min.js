$(document).ready(function() {
    $(".mindmap").each(function() {
        // MARK: 增加如下判断条件。因为在渲染页面时，ready方法会进来两次，导致对同一个导图多渲染了一次的bug
        if($(this).find("svg").length == 0) {
            MM_FUNCS.drawMindMap(this)
        }
    })
});
var MM_FUNCS = {
    li2jsonData: function(c) {
        var a;
        var b = c.children("a:first");
        if (b.length !== 0) {
            a = {
                "data": {
                    "text": b.text(),
                    "hyperlink": b.attr("href")
                }
            }
        } else {
            a = {
                "data": {
                    "text": c[0].childNodes[0].nodeValue.trim()
                }
            }
        }
        c.find("> ul > li").each(function() {
            if (!a.hasOwnProperty("children")) {
                a.children = []
            }
            a.children.push(MM_FUNCS.li2jsonData($(this)))
        });
        return a
    },
    drawMindMap: function(a) {
        var d = $(a).find(">ul:first");
        var c = {
            "root": {}
        };
        var b = new kityminder.Minder({
            renderTo: a
        });
        c.root = MM_FUNCS.li2jsonData(d.children("li:first"));
        b.importData("json", JSON.stringify(c));
        b.disable();
        b.execCommand("hand");
        $(d).hide()
    }
};